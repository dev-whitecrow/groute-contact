<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACTS29 2기 모집 상세</title>
    <meta name="description" content="ACTS29 2기 모집 상세 안내 페이지">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            background-color: #000000;
            -webkit-tap-highlight-color: transparent;
        }

        .page-wrapper {
            max-width: 480px;
            margin: 0 auto;
            /* Bottom padding for fixed CTA button clearance */
            padding-bottom: 80px;
        }

        .slide-container img {
            display: block;
            width: 100%;
            height: auto;
            /* Remove any gap between images */
            vertical-align: bottom;
        }

        /* Fixed CTA Button */
        .cta-wrapper {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: center;
            padding: 16px 20px;
            /* Subtle gradient backdrop */
            background: linear-gradient(to top, rgba(0,0,0,0.95) 60%, rgba(0,0,0,0));
            pointer-events: none;
        }

        .cta-button {
            display: block;
            width: 100%;
            max-width: 440px;
            padding: 16px 0;
            background-color: #00C9A1;
            color: #FFFFFF;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            text-decoration: none;
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 14px;
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            /* White neon glow */
            box-shadow:
                0 0 8px rgba(255, 255, 255, 0.4),
                0 0 20px rgba(255, 255, 255, 0.15),
                inset 0 0 8px rgba(255, 255, 255, 0.05);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            letter-spacing: 0.5px;
        }

        .cta-button:active {
            transform: scale(0.97);
        }

        @media (hover: hover) {
            .cta-button:hover {
                transform: translateY(-2px);
                box-shadow:
                    0 0 12px rgba(255, 255, 255, 0.6),
                    0 0 30px rgba(255, 255, 255, 0.25),
                    0 0 50px rgba(255, 255, 255, 0.1),
                    inset 0 0 10px rgba(255, 255, 255, 0.08);
            }
        }

        /* PC: wider max-width with side spacing */
        @media (min-width: 768px) {
            .page-wrapper {
                max-width: 520px;
            }
        }
    </style>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PMNST297BY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        // ─── A/B Group Assignment ───
        function getABGroup() {
            // URL param override for testing
            const urlParams = new URLSearchParams(window.location.search);
            const paramGroup = urlParams.get('group');
            if (paramGroup === 'A' || paramGroup === 'B') {
                localStorage.setItem('acts29_ab_group', paramGroup);
                return paramGroup;
            }

            // Check existing assignment
            let group = localStorage.getItem('acts29_ab_group');
            if (group === 'A' || group === 'B') return group;

            // Random 50:50
            group = Math.random() < 0.5 ? 'A' : 'B';
            localStorage.setItem('acts29_ab_group', group);
            return group;
        }

        const abGroup = getABGroup();

        // GA4 config with A/B group
        const urlParams = new URLSearchParams(window.location.search);
        gtag('config', 'G-PMNST297BY', {
            'page_title': 'ACTS29 Gen2 Detail',
            'campaign_source': urlParams.get('utm_source'),
            'campaign_medium': urlParams.get('utm_medium'),
            'ab_group': abGroup
        });

        // Custom page view event with A/B info
        gtag('event', 'detail_page_view', {
            'event_category': 'acts29_gen2',
            'ab_group': abGroup
        });

        // ─── Scroll Depth Tracking ───
        const scrollThresholds = [25, 50, 75, 100];
        const firedThresholds = new Set();

        function trackScroll() {
            const scrollTop = window.scrollY || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            if (docHeight <= 0) return;

            const scrollPercent = Math.round((scrollTop / docHeight) * 100);

            scrollThresholds.forEach(function(threshold) {
                if (scrollPercent >= threshold && !firedThresholds.has(threshold)) {
                    firedThresholds.add(threshold);
                    gtag('event', 'scroll_depth', {
                        'event_category': 'acts29_gen2',
                        'event_label': threshold + '%',
                        'ab_group': abGroup,
                        'scroll_percent': threshold
                    });
                }
            });
        }

        // Throttled scroll listener
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            if (scrollTimeout) return;
            scrollTimeout = setTimeout(function() {
                scrollTimeout = null;
                trackScroll();
            }, 200);
        }, { passive: true });

        // ─── Time on Page Tracking ───
        const pageLoadTime = Date.now();

        function sendTimeOnPage() {
            const seconds = Math.round((Date.now() - pageLoadTime) / 1000);
            gtag('event', 'time_on_page', {
                'event_category': 'acts29_gen2',
                'ab_group': abGroup,
                'duration_seconds': seconds
            });
        }

        window.addEventListener('beforeunload', sendTimeOnPage);
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden') sendTimeOnPage();
        });

        // ─── CTA Click Tracking ───
        function handleCTAClick(e) {
            e.preventDefault();
            var url = abGroup === 'A'
                ? 'https://tally.so/r/lbd4YN'
                : 'https://tally.so/r/VL5xbM';

            gtag('event', 'cta_click', {
                'event_category': 'acts29_gen2',
                'event_label': 'apply_button',
                'ab_group': abGroup,
                'destination_url': url
            });

            // Small delay to ensure GA event fires
            setTimeout(function() {
                window.location.href = url;
            }, 250);
        }
    </script>
</head>
<body>
    <div class="page-wrapper">
        <div class="slide-container" id="slideContainer">
            <!-- Slides injected by JS based on A/B group -->
        </div>
    </div>

    <!-- Fixed CTA -->
    <div class="cta-wrapper">
        <a class="cta-button" id="ctaButton" href="#" onclick="handleCTAClick(event)">
            지원하기
        </a>
    </div>

    <script>
        // ─── Build Slide Sequence ───
        var slides = [];

        if (abGroup === 'A') {
            slides.push('acts29_gen2/Slide 1-1 TestA.jpeg');
            slides.push('acts29_gen2/Slide 1-2 TestA.jpeg');
        } else {
            slides.push('acts29_gen2/Slide 1 TestB.jpeg');
        }

        // Common slides 2~15
        for (var i = 2; i <= 15; i++) {
            slides.push('acts29_gen2/Slide ' + i + ' Common.jpeg');
        }

        // Render
        var container = document.getElementById('slideContainer');
        slides.forEach(function(src, idx) {
            var img = document.createElement('img');
            img.src = src;
            img.alt = 'ACTS29 상세 ' + (idx + 1);
            img.loading = idx < 3 ? 'eager' : 'lazy';
            img.decoding = 'async';
            container.appendChild(img);
        });
    </script>
</body>
</html>
